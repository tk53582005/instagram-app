<div style="max-width: 600px; margin: 0 auto; padding: 30px 20px;">
  <div style="background: white; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); padding: 40px;">
    <h2 style="font-size: 24px; font-weight: 400; margin-bottom: 30px; text-align: center;">プロフィール編集</h2>

    <%= form_with model: @user, url: profile_path(@user.username), method: :patch, 
                  local: true, html: { style: "display: block;" } do |f| %>
      
      <!-- エラーメッセージ -->
      <% if @user.errors.any? %>
        <div style="background: #fee; border: 1px solid #fcc; border-radius: 4px; padding: 15px; margin-bottom: 20px;">
          <h3 style="color: #c00; font-size: 14px; margin: 0 0 10px 0;"><%= pluralize(@user.errors.count, "error") %> prohibited this user from being saved:</h3>
          <ul style="margin: 0; padding-left: 20px;">
            <% @user.errors.full_messages.each do |message| %>
              <li style="color: #c00; font-size: 13px;"><%= message %></li>
            <% end %>
          </ul>
        </div>
      <% end %>

      <!-- プロフィール画像 -->
      <div style="text-align: center; margin-bottom: 30px;">
        <div style="margin-bottom: 15px;">
          <%= image_tag @user.profile_image_url, 
                        id: "profile-preview",
                        style: "width: 120px; height: 120px; border-radius: 50%; object-fit: cover; cursor: pointer; border: 1px solid #dbdbdb;" %>
        </div>
        
        <%= f.file_field :profile_image, 
                         id: "profile-image-input",
                         style: "display: none;",
                         accept: "image/*",
                         onchange: "previewImage(event)" %>
        
        <button type="button" 
                onclick="document.getElementById('profile-image-input').click()"
                style="background: none; border: none; color: #0095f6; font-weight: 600; font-size: 14px; cursor: pointer;">
          プロフィール画像を変更
        </button>
      </div>

      <!-- ユーザー名 -->
      <div style="margin-bottom: 20px;">
        <%= f.label :username, "ユーザー名", style: "display: block; font-weight: 600; margin-bottom: 8px; font-size: 14px;" %>
        <%= f.text_field :username, style: "width: 100%; padding: 10px; border: 1px solid #dbdbdb; border-radius: 4px; font-size: 14px; box-sizing: border-box;" %>
      </div>

      <!-- 名前 -->
      <div style="margin-bottom: 30px;">
        <%= f.label :name, "名前", style: "display: block; font-weight: 600; margin-bottom: 8px; font-size: 14px;" %>
        <%= f.text_field :name, style: "width: 100%; padding: 10px; border: 1px solid #dbdbdb; border-radius: 4px; font-size: 14px; box-sizing: border-box;" %>
      </div>

      <!-- 送信ボタン -->
      <div style="display: flex; gap: 10px;">
        <%= f.submit "保存", style: "flex: 1; padding: 10px; background: #0095f6; color: white; border: none; border-radius: 8px; font-weight: 600; font-size: 14px; cursor: pointer;" %>
        <%= link_to "キャンセル", profile_path(@user.username), 
                    style: "flex: 1; padding: 10px; background: #efefef; color: #262626; border: 1px solid #dbdbdb; border-radius: 8px; text-align: center; text-decoration: none; font-weight: 600; font-size: 14px; display: block; box-sizing: border-box; line-height: 1.5;" %>
      </div>
    <% end %>
  </div>
</div>

<script>
function previewImage(event) {
  const file = event.target.files[0];
  if (file) {
    const reader = new FileReader();
    reader.onload = function(e) {
      document.getElementById('profile-preview').src = e.target.result;
    }
    reader.readAsDataURL(file);
  }
}
</script>